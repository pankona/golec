# 2017/06/13 のメモ

## メニュー

* cgo について
  * C 言語から Go 言語のライブラリを利用する
  * Go 言語から C 言語のライブラリを利用する

## C 言語から Go 言語のライブラリを利用する

ざっくりとした手順は以下。

* Go でライブラリを作成する。
  * この際、export する関数 (C 言語から使われる予定のもの) を明示する必要がある。
  * ライブラリを作成すると、ライブラリとヘッダが生成される。
* C 言語から使う。

[サンプルソース](./c2go)

### ポイント

* ライブラリ作成時のポイント
  * import "C" する。
  * //export で始まるコメントをいれることで、C から使える関数になる。
  * ` $go build -buildmode=c-archive fizzbuzz.go` のように、buildmode を指定することでライブラリが出力される。
  * **Go のポインタを C で利用することは、基本的にはできない**
    * Go にはガベージコレクションがあり、C にはない、みたいな差が。
    * C.char など、C 言語側で分かる型に変えてあげる
    * string を返すことができない
* C 言語から使うときのポイント
  * ヘッダに色々と型の定義が吐き出されているので参考にする。

## Go 言語から C 言語のライブラリを利用する

ざっくりとした手順は以下。

* C 言語でライブラリを作成する。
* Go 言語側で C のソースを書いて、上記のライブラリを利用する。

[サンプルソース](./go2c)

* ライブラリ作成時のポイント
  * C のお作法で普通に作る。
  * ただ、ポインタを返すみたいなのは例によって厳しいので、値コピー戦略を取るほうがやりやすい。
